(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7278],{560:(e,t,s)=>{Promise.resolve().then(s.bind(s,9601))},9601:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(5155),n=s(2115);class r{set(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let a=this.getFullKey(e),n={key:a,value:t,timestamp:Date.now()};s.ttl&&(n.expiresAt=Date.now()+s.ttl),s.compress&&this.shouldCompress(t)&&(n.value=this.compress(JSON.stringify(t)),n.value="compressed:".concat(n.value)),s.encrypt&&(n.value=this.encrypt(JSON.stringify(n.value)),n.value="encrypted:".concat(n.value)),this.updateCache(a,n);let r=JSON.stringify(n);return this.getStorageSize()+r.length>this.maxSize&&this.cleanupOldData(),(s.persistent?localStorage:sessionStorage).setItem(a,r),!0}catch(e){return console.warn("Failed to store data:",e),!1}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let s=this.getFullKey(e),a=this.cache.get(s);if(a){if(a.expiresAt&&Date.now()>a.expiresAt)return this.cache.delete(s),this.remove(e,t),null;return this.processValue(a.value)}let n=(t.persistent?localStorage:sessionStorage).getItem(s);if(!n)return null;let r=JSON.parse(n);if(r.expiresAt&&Date.now()>r.expiresAt)return this.remove(e,t),null;return this.updateCache(s,r),this.processValue(r.value)}catch(e){return null}}processValue(e){let t=e;return"string"==typeof t&&t.startsWith("encrypted:")&&(t=JSON.parse(t=this.decrypt(t.replace("encrypted:","")))),"string"==typeof t&&t.startsWith("compressed:")&&(t=JSON.parse(t=this.decompress(t.replace("compressed:","")))),t}updateCache(e,t){if(this.cache.size>=this.cacheSize){let e=this.cache.keys().next().value;e&&this.cache.delete(e)}this.cache.set(e,t)}remove(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let s=this.getFullKey(e);return this.cache.delete(s),(t.persistent?localStorage:sessionStorage).removeItem(s),!0}catch(e){return console.warn("Failed to remove data"),!1}}has(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let s=this.getFullKey(e);if(this.cache.has(s))return!0;let a=t.persistent?localStorage:sessionStorage;return null!==a.getItem(s)}catch(e){return!1}}keys(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=e.persistent?localStorage:sessionStorage,s=[];for(let e=0;e<t.length;e++){let a=t.key(e);(null==a?void 0:a.startsWith(this.prefix))&&s.push(a.replace("".concat(this.prefix,":"),""))}return s}catch(e){return console.warn("Failed to get keys"),[]}}clear(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return this.keys(e).forEach(t=>{this.remove(t,e)}),!0}catch(e){return console.warn("Failed to clear data"),!1}}getStorageSize(){try{var e,t,s,a;let n=0;for(let s=0;s<localStorage.length;s++){let a=localStorage.key(s);(null==a?void 0:a.startsWith(this.prefix))&&(n+=a.length+(null!=(t=null==(e=localStorage.getItem(a))?void 0:e.length)?t:0))}for(let e=0;e<sessionStorage.length;e++){let t=sessionStorage.key(e);(null==t?void 0:t.startsWith(this.prefix))&&(n+=t.length+(null!=(a=null==(s=sessionStorage.getItem(t))?void 0:s.length)?a:0))}return n}catch(e){return 0}}cleanupExpiredData(){let e=Date.now();if(!(e-this.lastCleanup<this.cleanupInterval))try{[localStorage,sessionStorage].forEach(t=>{this.keys({persistent:t===localStorage}).forEach(s=>{let a=this.get(s,{persistent:t===localStorage});a&&"object"==typeof a&&"expiresAt"in a&&"number"==typeof a.expiresAt&&e>a.expiresAt&&this.remove(s,{persistent:t===localStorage})})}),this.lastCleanup=e}catch(e){console.warn("Failed to cleanup expired data")}}cleanupOldData(){try{[localStorage,sessionStorage].forEach(e=>{let t=this.keys({persistent:e===localStorage}),s=[];t.forEach(t=>{let a=this.get(t,{persistent:e===localStorage});if(a&&"object"==typeof a&&"timestamp"in a){var n;let e=JSON.stringify(a);s.push({key:t,timestamp:null!=(n=a.timestamp)?n:0,size:e.length})}}),s.sort((e,t)=>e.timestamp-t.timestamp);let a=0,n=.2*this.maxSize;for(let t of s){if(a>=n)break;this.remove(t.key,{persistent:e===localStorage}),a+=t.size}})}catch(e){console.warn("Failed to cleanup old data")}}shouldCompress(e){return JSON.stringify(e).length>this.compressionThreshold}compress(e){try{return btoa(e)}catch(t){return e}}decompress(e){try{return atob(e)}catch(t){return e}}encrypt(e){try{return btoa(e)}catch(t){return e}}decrypt(e){try{return atob(e)}catch(t){return e}}getFullKey(e){return"".concat(this.prefix,":").concat(e)}exportData(){let e={};try{this.keys({persistent:!0}).forEach(t=>{e[t]=this.get(t,{persistent:!0})}),this.keys({persistent:!1}).forEach(t=>{e["session:".concat(t)]=this.get(t,{persistent:!1})})}catch(e){console.warn("Failed to export data")}return e}importData(e){try{return Object.entries(e).forEach(e=>{let[t,s]=e;if(t.startsWith("session:")){let e=t.replace("session:","");this.set(e,s,{persistent:!1})}else this.set(t,s,{persistent:!0})}),!0}catch(e){return console.warn("Failed to import data:",e),!1}}clearCache(){this.cache.clear()}constructor(){this.prefix="coach-hub-auto-save",this.maxSize=0xa00000,this.compressionThreshold=1024,this.cache=new Map,this.cacheSize=100,this.lastCleanup=Date.now(),this.cleanupInterval=3e5,this.cleanupExpiredData()}}let i=new r;class l{init(){this.isInitialized||(this.loadFromStorage(),this.setupEventListeners(),this.setupBeforeUnload(),this.isInitialized=!0,console.warn("\uD83D\uDE80 Auto-save system initialized with optimized performance"))}setupEventListeners(){document.addEventListener("input",this.debouncedSave.bind(this),{passive:!0}),document.addEventListener("change",this.debouncedSave.bind(this),{passive:!0}),document.addEventListener("input",this.debouncedSave.bind(this),{passive:!0,capture:!0})}setupBeforeUnload(){window.addEventListener("beforeunload",e=>{if(this.hasUnsavedChanges())return e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to leave?",e.returnValue})}autoSave(e){let t=e.target;t&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement?this.saveInput(t):t.isContentEditable?this.saveContentEditable(t):t instanceof HTMLFormElement&&this.saveForm(t))}saveInput(e){let t=this.generateId(e),s=e.value;if(!this.hasContentChanged(t,s))return;let a={id:t,content:s,timestamp:Date.now(),filePath:window.location.pathname,metadata:{type:this.getValidType(e.type),name:e.name,id:e.id,className:e.className}};this.queueSave(a)}saveContentEditable(e){var t,s;let a=this.generateId(e),n=null!=(t=e.innerHTML)?t:"";if(!this.hasContentChanged(a,n))return;let r={id:a,content:n,timestamp:Date.now(),filePath:window.location.pathname,metadata:{type:"contenteditable",id:null!=(s=e.id)?s:""}};this.queueSave(r)}saveForm(e){let t=new FormData(e),s={};for(let[e,a]of t.entries())s[e]=a;let a=this.generateId(e),n=JSON.stringify(s);if(!this.hasContentChanged(a,n))return;let r={id:a,content:n,timestamp:Date.now(),filePath:window.location.pathname,metadata:{type:"form",action:e.action,method:e.method,id:e.id}};this.queueSave(r)}hasContentChanged(e,t){return this.lastContentCache.get(e)!==t&&(this.lastContentCache.set(e,t),!0)}queueSave(e){this.entries.set(e.id,e),this.pendingSaves.add(e.id),this.scheduleBatchSave(),window.dispatchEvent(new CustomEvent("auto-save",{detail:e}))}scheduleBatchSave(){this.batchSaveTimeout&&clearTimeout(this.batchSaveTimeout),this.batchSaveTimeout=setTimeout(()=>{this.executeBatchSave()},100)}executeBatchSave(){if(0!==this.pendingSaves.size)try{let e=Array.from(this.entries.values());if(e.length>this.config.maxEntries){let t=e.sort((e,t)=>t.timestamp-e.timestamp).slice(0,this.config.maxEntries);this.entries=new Map(t.map(e=>[e.id,e]))}i.set(this.config.storageKey,Array.from(this.entries.entries()),this.config.storageOptions),this.pendingSaves.clear()}catch(e){console.warn("Failed to persist auto-save data:",e)}}generateId(e){var t,s,a;let n=null!=(a=null!=(s=null!=(t=e.id)?t:e.name)?s:e.className)?a:"unknown",r=window.location.pathname;return"".concat(r,":").concat(n)}getValidType(e){return"submit"===e||"button"===e||"reset"===e?"form":"input"}saveEntry(e){this.hasContentChanged(e.id,e.content)&&(this.entries.set(e.id,e),this.pendingSaves.add(e.id),this.scheduleBatchSave(),window.dispatchEvent(new CustomEvent("auto-save",{detail:e})))}persistToStorage(){this.executeBatchSave()}loadFromStorage(){try{let e=i.get(this.config.storageKey,this.config.storageOptions);if(e&&Array.isArray(e))for(let[t,s]of(this.entries=new Map(e),this.entries))this.lastContentCache.set(t,s.content)}catch(e){console.warn("Failed to load auto-save data:",e)}}hasUnsavedChanges(){return this.entries.size>0}getUnsavedEntries(){return Array.from(this.entries.values())}getEntriesForPath(e){return Array.from(this.entries.values()).filter(t=>t.filePath===e)}getEntry(e){var t;return null!=(t=this.entries.get(e))?t:null}clearEntry(e){this.entries.delete(e),this.lastContentCache.delete(e),this.pendingSaves.delete(e),this.scheduleBatchSave()}clearAllEntries(){this.entries.clear(),this.lastContentCache.clear(),this.pendingSaves.clear(),this.scheduleBatchSave()}async attemptRecovery(){let e=window.location.pathname,t=this.getEntriesForPath(e);return t.length>0?(console.warn("\uD83D\uDD04 Found ".concat(t.length," unsaved entries for recovery")),t):[]}forceSave(){this.executeBatchSave()}cleanup(){this.batchSaveTimeout&&(clearTimeout(this.batchSaveTimeout),this.batchSaveTimeout=null),this.lastContentCache.clear(),this.pendingSaves.clear()}constructor(e={}){this.entries=new Map,this.isInitialized=!1,this.pendingSaves=new Set,this.batchSaveTimeout=null,this.lastContentCache=new Map,this.config={debounceMs:2e3,maxEntries:100,storageKey:"coach-hub-auto-save",enableRecovery:!0,storageOptions:{persistent:!0,compress:!0,ttl:6048e5},...e},this.debouncedSave=function(e,t){let s=null;return a=>{s&&clearTimeout(s),s=setTimeout(()=>{e(a)},t)}}(e=>{this.autoSave(e)},this.config.debounceMs)}}let o=new l;function c(e){let{id:t,type:s="input",debounceMs:a=2e3,autoRestore:r=!0,onSave:i,onRestore:l}=e,c=(0,n.useRef)(null),h=(0,n.useRef)(""),d=(0,n.useRef)(!1),u=(0,n.useRef)(null),m=(0,n.useMemo)(()=>"".concat(t,"-").concat(s),[t,s]),p=(0,n.useCallback)(e=>{c.current=e,e&&r&&setTimeout(()=>{f()},200)},[r]),g=(0,n.useCallback)(e=>{u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{v(e)},a)},[a]),v=(0,n.useCallback)(e=>{if(!c.current||d.current||e===h.current)return;let a={id:m,content:e,timestamp:Date.now(),filePath:window.location.pathname,metadata:{type:"textarea"===s?"input":s,id:t,elementType:c.current.tagName.toLowerCase(),className:c.current.className}};o.saveEntry(a),h.current=e,i&&i(e)},[m,s,i]),f=(0,n.useCallback)(async()=>{if(c.current&&r)try{let e=o.getEntriesForPath(window.location.pathname).find(e=>{var a,n;return(null==(a=e.metadata)?void 0:a.id)===t&&(null==(n=e.metadata)?void 0:n.type)===s});e&&e.content!==h.current&&(d.current=!0,c.current instanceof HTMLInputElement||c.current instanceof HTMLTextAreaElement?(c.current.value=e.content,c.current.dispatchEvent(new Event("input",{bubbles:!0}))):c.current.isContentEditable&&(c.current.innerHTML=e.content,c.current.dispatchEvent(new Event("input",{bubbles:!0}))),o.clearEntry(e.id),l&&l(e.content),console.log("\uD83D\uDD04 Restored content for ".concat(t)))}catch(e){console.warn("Failed to restore content:",e)}finally{d.current=!1}},[t,s,r,l]),y=(0,n.useCallback)(()=>{f()},[f]),x=(0,n.useCallback)(()=>{o.getEntriesForPath(window.location.pathname).forEach(e=>{var a,n;(null==(a=e.metadata)?void 0:a.id)===t&&(null==(n=e.metadata)?void 0:n.type)===s&&o.clearEntry(e.id)})},[t,s]),b=(0,n.useCallback)(()=>{if(!c.current)return;let e="";c.current instanceof HTMLInputElement||c.current instanceof HTMLTextAreaElement?e=c.current.value:c.current.isContentEditable&&(e=c.current.innerHTML),g(e)},[g]);return(0,n.useEffect)(()=>{let e=c.current;if(e)return e.addEventListener("input",b,{passive:!0}),e.addEventListener("change",b,{passive:!0}),e.isContentEditable&&(e.addEventListener("paste",b,{passive:!0}),e.addEventListener("keydown",b,{passive:!0})),()=>{e.removeEventListener("input",b),e.removeEventListener("change",b),e.isContentEditable&&(e.removeEventListener("paste",b),e.removeEventListener("keydown",b))}},[b]),(0,n.useEffect)(()=>()=>{u.current&&clearTimeout(u.current)},[x]),(0,n.useMemo)(()=>({setElementRef:p,saveContent:v,restoreContent:y,clearAutoSave:x,hasUnsavedChanges:()=>o.getEntriesForPath(window.location.pathname).some(e=>{var a,n;return(null==(a=e.metadata)?void 0:a.id)===t&&(null==(n=e.metadata)?void 0:n.type)===s})}),[p,v,y,x,t,s])}function h(e,t){return c({id:e,type:"input",...t})}function d(){let[e,t]=(0,n.useState)({name:"",email:"",message:""}),{setElementRef:s,hasUnsavedChanges:r}=h("name",{debounceMs:2e3}),{setElementRef:i,hasUnsavedChanges:l}=h("email",{debounceMs:2e3}),{setElementRef:o,hasUnsavedChanges:d}=c({id:"message",type:"textarea",debounceMs:2e3}),u=e=>s=>{t(t=>({...t,[e]:s.target.value}))},m=r()||l()||d();return(0,a.jsxs)("div",{className:"container mx-auto p-6 max-w-2xl",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Auto-Save Performance Demo"}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Performance Optimizations Applied:"}),(0,a.jsxs)("ul",{className:"text-blue-700 space-y-1 text-sm",children:[(0,a.jsx)("li",{children:"✅ Increased debounce interval from 1000ms to 2000ms"}),(0,a.jsx)("li",{children:"✅ Content diffing to prevent redundant saves"}),(0,a.jsx)("li",{children:"✅ Batch storage operations"}),(0,a.jsx)("li",{children:"✅ Event deduplication with passive listeners"}),(0,a.jsx)("li",{children:"✅ Memory optimization with cleanup"}),(0,a.jsx)("li",{children:"✅ Smart caching in storage manager"})]})]}),(0,a.jsxs)("form",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-2",children:["Name ",r()&&(0,a.jsx)("span",{className:"text-orange-600",children:"(Unsaved)"})]}),(0,a.jsx)("input",{ref:s,type:"text",id:"name",value:e.name,onChange:u("name"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:["Email ",l()&&(0,a.jsx)("span",{className:"text-orange-600",children:"(Unsaved)"})]}),(0,a.jsx)("input",{ref:i,type:"email",id:"email",value:e.email,onChange:u("email"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your email"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{htmlFor:"message",className:"block text-sm font-medium text-gray-700 mb-2",children:["Message ",d()&&(0,a.jsx)("span",{className:"text-orange-600",children:"(Unsaved)"})]}),(0,a.jsx)("textarea",{ref:o,id:"message",value:e.message,onChange:u("message"),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your message"})]}),(0,a.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Auto-Save Status"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Name field:"}),(0,a.jsx)("span",{className:r()?"text-orange-600 font-medium":"text-green-600",children:r()?"Unsaved":"Saved"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Email field:"}),(0,a.jsx)("span",{className:l()?"text-orange-600 font-medium":"text-green-600",children:l()?"Unsaved":"Saved"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Message field:"}),(0,a.jsx)("span",{className:d()?"text-orange-600 font-medium":"text-green-600",children:d()?"Unsaved":"Saved"})]}),(0,a.jsx)("div",{className:"pt-2 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"font-medium",children:"Overall status:"}),(0,a.jsx)("span",{className:m?"text-orange-600 font-bold":"text-green-600 font-bold",children:m?"Has Unsaved Changes":"All Changes Saved"})]})})]})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"Testing Instructions"}),(0,a.jsxs)("ol",{className:"text-yellow-700 text-sm space-y-1 list-decimal list-inside",children:[(0,a.jsx)("li",{children:"Type in any field - notice the 2-second delay before auto-save"}),(0,a.jsx)("li",{children:"Type the same content again - no save will occur (content diffing)"}),(0,a.jsx)("li",{children:"Open browser dev tools and check the console for auto-save logs"}),(0,a.jsx)("li",{children:"Check localStorage for saved data"}),(0,a.jsx)("li",{children:"Refresh the page to test recovery functionality"})]})]})]})]})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>o.init()):o.init(),window.addEventListener("beforeunload",()=>{o.cleanup()})}},e=>{e.O(0,[8441,5964,7358],()=>e(e.s=560)),_N_E=e.O()}]);